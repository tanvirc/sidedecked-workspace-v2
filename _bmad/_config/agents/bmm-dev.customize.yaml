# Agent Customization - Developer (Amelia)
# SideDecked project context

critical_actions:
  - "ALWAYS write tests FIRST (TDD): failing test -> minimal code -> pass -> refactor. Minimum 80% coverage before marking story complete."
  - "PRE-COMMIT BUILD GATE (MANDATORY, BLOCKING): Before committing ANY code to the branch, run `npm run lint && npm run typecheck && npm run build && npm test` in each affected repo. ALL four commands MUST pass with zero errors. If the build fails, STOP - diagnose and fix ALL build errors before committing. NEVER commit code that does not build."
  - "BUILD ERROR RECOVERY: When `npm run build` fails - read the full error output, identify root cause, fix the offending files, re-run the full quality gate, and only commit once the gate is clean. Do not suppress errors with type assertions, `any`, or `// @ts-ignore` unless the story explicitly permits it."
  - "NEVER mix mercur-db and sidedecked-db: Commerce changes go in backend/, customer data changes go in customer-backend/"
  - "NEVER add AI references in code, docs, or commits ('Claude', 'Co-Authored-By: Claude', robot emoji)"
  - "UI TOKEN SELF-CHECK: After implementing any UI component, grep for hardcoded color/spacing patterns (bg-gray-*, text-gray-*, #hex, rgb(), hsl(), inline px). Fix violations before marking task complete. This catches issues in Phase 4 instead of waiting for Phase 5B."
  - "FIGMA DESIGN CONTEXT: When a story has Figma reference, call get_design_context and get_variable_defs BEFORE building the token mapping table. Figma tokens take precedence over HTML wireframe CSS on conflicts. NEVER call get_metadata or get_design_context on root 0:1 or bare page nodes â€” they exceed the token limit. Use section nodes: Homepage=42:8, Auth=38:9, Search=44:11, Card Detail=46:32, Profile=48:9, Deck Builder=50:9, Deck Browser=52:9, Deck Viewer=54:9. If a section node is still too large, call get_metadata on it, read first 3KB with `head -c 3000`, find child IDs, then call get_design_context on a child."
  - "CODE CONNECT MAPPING: After UI components pass wireframe compliance, map each component to its Figma node via add_code_connect_map (label: 'React'). For multiple mappings, batch with send_code_connect_mappings."

memories:
  - "Four repos: backend/ (MercurJS :9000, mercur-db), customer-backend/ (Node.js+TypeORM :7000, sidedecked-db), storefront/ (Next.js 14 :3000), vendorpanel/ (React+Vite :5173)"
  - "MedusaJS v2 forbidden patterns: MedusaRequest (use MedusaStoreRequest), './modules/auth' string (use { resolve: }), () => new Date() defaults, authIdentity: null (use undefined), [Service1, Service2] array exports, declaring created_at/updated_at (implicit)"
  - "ORM: TypeORM always (NEVER Prisma). Database: PostgreSQL (NEVER MongoDB/SQLite). Testing: Vitest + Jest (NEVER Mocha)"
  - "Quality gate: lint + typecheck + build + test must ALL pass. Coverage > 80% on changed modules."
  - "Commits: conventional commits format 'type(scope): description'. FORBIDDEN: 'Claude', 'Co-Authored-By: Claude', TODO comments, robot emojis"
  - "Stories live in _bmad-output/implementation-artifacts/. Epic definitions live in _bmad-output/planning-artifacts/epics.md. Use node scripts/check-acceptance-criteria.js --id <epic-id> --next-story to find current work."
  - "Acceptance criteria tags: (IMPLEMENTED) = done, (IN PROGRESS) = partial, (NOT BUILT) = not started"
  - "Figma Storefront file key: k5seLEn5Loi0YJ6UrJvzpr (wireframes, story nodes). Voltage Design System file key: QNFLTck7Bpd3OmJjwktKBf (token authority). Extract figma_file_key and figma_story_node_id from the story's UX Design Reference section. Primary tools: get_design_context, get_variable_defs, add_code_connect_map, send_code_connect_mappings."
