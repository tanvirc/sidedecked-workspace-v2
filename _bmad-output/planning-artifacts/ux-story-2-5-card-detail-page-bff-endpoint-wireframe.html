<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SideDecked ‚Äî Story 2-5: Card Detail Page (BFF Endpoint) Wireframe</title>
<style>
/* ============================================================
   DESIGN TOKENS ‚Äî Midnight Forge
   ============================================================ */
:root {
  --bg-base: #0C0D12;
  --bg-surface-1: #13141A;
  --bg-surface-2: #1A1C24;
  --bg-surface-3: #22242E;
  --bg-surface-4: #2A2D38;

  --accent-primary: #D4A843;
  --accent-primary-hover: #E0B94F;
  --interactive: #7C8CFF;
  --interactive-hover: #9BA6FF;

  --positive: #4ADE80;
  --negative: #EF5350;
  --warning: #FBBF24;

  --text-primary: #E8ECF1;
  --text-secondary: #8B93A6;
  --text-tertiary: #4F5568;
  --text-price: #D4A843;

  --border-subtle: rgba(255,255,255,0.06);
  --border-default: rgba(255,255,255,0.10);

  --rarity-common: #6B6B6B;
  --rarity-uncommon: #A8B4C0;
  --rarity-rare: #D4A843;
  --rarity-mythic: #E85D26;

  --radius-sm: 6px;
  --radius-md: 10px;
  --radius-lg: 16px;
  --radius-xl: 24px;

  --sp-1: 4px;
  --sp-2: 8px;
  --sp-3: 12px;
  --sp-4: 16px;
  --sp-5: 24px;
  --sp-6: 32px;
  --sp-7: 48px;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  font-size: 14px;
  line-height: 1.5;
  color: var(--text-primary);
  background: var(--bg-base);
  -webkit-font-smoothing: antialiased;
}
body { min-height: 100vh; }

/* ============================================================
   HEADER
   ============================================================ */
.wireframe-header {
  text-align: center;
  padding: var(--sp-6) var(--sp-5) var(--sp-5);
  border-bottom: 1px solid var(--border-subtle);
  background: var(--bg-surface-1);
}
.wireframe-header h1 { font-size: 22px; font-weight: 700; color: var(--text-primary); }
.wireframe-header h1 span { color: var(--accent-primary); }
.wireframe-header p { margin-top: var(--sp-2); font-size: 12px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.06em; }

/* ============================================================
   TAB NAV
   ============================================================ */
.tab-nav {
  display: flex;
  justify-content: center;
  gap: var(--sp-2);
  padding: var(--sp-3) var(--sp-5);
  background: var(--bg-surface-1);
  border-bottom: 1px solid var(--border-subtle);
  flex-wrap: wrap;
  position: sticky;
  top: 0;
  z-index: 100;
}
.tab-btn {
  display: inline-flex; align-items: center; gap: var(--sp-2);
  padding: var(--sp-2) var(--sp-4);
  border: 1px solid var(--border-default);
  border-radius: var(--radius-xl);
  background: transparent;
  color: var(--text-secondary);
  font-size: 12px; font-weight: 500;
  cursor: pointer; transition: all 0.2s;
  font-family: inherit;
}
.tab-btn:hover { color: var(--text-primary); border-color: var(--interactive); background: rgba(124,140,255,0.06); }
.tab-btn.active { color: var(--bg-base); background: var(--accent-primary); border-color: var(--accent-primary); }

/* ============================================================
   PANELS
   ============================================================ */
.panels { padding: var(--sp-5); }
.panel { display: none; max-width: 1100px; margin: 0 auto; animation: fadeIn 0.25s ease; }
.panel.active { display: block; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }

.panel-label {
  display: inline-block; padding: var(--sp-1) var(--sp-3);
  border-radius: var(--radius-sm); background: rgba(124,140,255,0.10);
  color: var(--interactive); font-size: 11px; font-weight: 600;
  text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: var(--sp-3);
}
.panel-title { font-size: 20px; font-weight: 700; margin-bottom: var(--sp-2); }
.panel-desc { font-size: 13px; color: var(--text-secondary); margin-bottom: var(--sp-5); max-width: 640px; line-height: 1.7; }

/* ============================================================
   ANNOTATIONS
   ============================================================ */
.annotation {
  background: rgba(212,168,67,0.08);
  border: 1px dashed rgba(212,168,67,0.35);
  border-radius: var(--radius-sm);
  padding: var(--sp-2) var(--sp-3);
  font-size: 11px; color: var(--accent-primary);
  margin-bottom: var(--sp-3);
  line-height: 1.6;
}
.annotation strong { font-weight: 600; }
.annotation-blue {
  background: rgba(124,140,255,0.08);
  border-color: rgba(124,140,255,0.35);
  color: var(--interactive);
}

/* ============================================================
   SHARED COMPONENTS
   ============================================================ */
.price { font-family: 'SF Mono', 'Cascadia Code', Consolas, monospace; font-variant-numeric: tabular-nums; font-weight: 500; color: var(--text-price); }

.badge {
  display: inline-flex; align-items: center; gap: 4px;
  padding: 2px 8px; border-radius: var(--radius-sm);
  font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.04em;
}
.badge-rare { background: rgba(212,168,67,0.14); color: var(--rarity-rare); }
.badge-uncommon { background: rgba(168,180,192,0.14); color: var(--rarity-uncommon); }
.badge-mtg { background: rgba(139,76,181,0.18); color: #C084FC; }
.badge-pokemon { background: rgba(250,204,21,0.14); color: #FBBF24; }

.rarity-dot { width: 6px; height: 6px; border-radius: 50%; display: inline-block; }
.dot-rare { background: var(--rarity-rare); }

.gold-btn {
  display: inline-flex; align-items: center; justify-content: center; gap: var(--sp-2);
  padding: var(--sp-2) var(--sp-4);
  background: var(--accent-primary); color: var(--bg-base);
  border: none; border-radius: var(--radius-sm);
  font-size: 13px; font-weight: 600; cursor: pointer;
  transition: background 0.15s; font-family: inherit;
}
.gold-btn:hover { background: var(--accent-primary-hover); }
.gold-btn:disabled { background: var(--bg-surface-4); color: var(--text-tertiary); cursor: not-allowed; }

.ghost-btn {
  display: inline-flex; align-items: center; gap: var(--sp-2);
  padding: var(--sp-2) var(--sp-3);
  background: transparent; color: var(--text-secondary);
  border: 1px solid var(--border-default); border-radius: var(--radius-sm);
  font-size: 12px; font-weight: 500; cursor: pointer; font-family: inherit;
}
.ghost-btn:hover { color: var(--text-primary); border-color: rgba(255,255,255,0.2); }

/* ============================================================
   CARD DETAIL LAYOUT
   ============================================================ */
.card-detail-grid {
  display: grid;
  grid-template-columns: 320px 1fr;
  gap: var(--sp-6);
  align-items: start;
}
@media (max-width: 768px) {
  .card-detail-grid { grid-template-columns: 1fr; }
}

/* Left column */
.card-image-column {}
.card-image-hero {
  width: 100%;
  aspect-ratio: 63/88;
  background: linear-gradient(160deg, var(--bg-surface-2), var(--bg-surface-3));
  border-radius: var(--radius-lg);
  border: 1px solid var(--border-subtle);
  display: flex; align-items: center; justify-content: center;
  position: relative; overflow: hidden;
  margin-bottom: var(--sp-4);
}
.card-image-hero-inner {
  text-align: center; color: var(--text-tertiary); font-size: 12px; z-index: 1;
}
.card-image-hero-inner svg { display: block; margin: 0 auto var(--sp-2); opacity: 0.3; }
.card-image-overlay {
  position: absolute; bottom: 0; left: 0; right: 0;
  padding: var(--sp-3);
  background: linear-gradient(0deg, rgba(12,13,18,0.9) 60%, transparent);
}
.card-foil-badge {
  display: inline-flex; align-items: center; gap: 4px;
  padding: 2px 8px; border-radius: var(--radius-sm);
  background: linear-gradient(90deg, rgba(212,168,67,0.2), rgba(232,93,38,0.2));
  border: 1px solid rgba(212,168,67,0.3);
  color: var(--accent-primary); font-size: 11px; font-weight: 600;
}

/* Right column */
.card-detail-content {}
.card-game-row {
  display: flex; align-items: center; gap: var(--sp-2); margin-bottom: var(--sp-3);
}
.card-name {
  font-size: 28px; font-weight: 800; letter-spacing: -0.02em;
  color: var(--text-primary); margin-bottom: var(--sp-2); line-height: 1.1;
}
.card-type-line { font-size: 13px; color: var(--text-secondary); margin-bottom: var(--sp-4); }
.card-set-info {
  display: flex; align-items: center; gap: var(--sp-3);
  padding: var(--sp-3); background: var(--bg-surface-2); border-radius: var(--radius-md);
  border: 1px solid var(--border-subtle); margin-bottom: var(--sp-4);
}
.card-set-icon {
  width: 36px; height: 36px; border-radius: var(--radius-sm);
  background: var(--bg-surface-4); display: flex; align-items: center; justify-content: center;
  font-size: 18px; flex-shrink: 0;
}
.set-name { font-size: 13px; font-weight: 600; color: var(--text-primary); }
.set-meta { font-size: 12px; color: var(--text-secondary); margin-top: 2px; }

/* Section dividers */
.section { margin-top: var(--sp-5); }
.section-header {
  display: flex; align-items: center; gap: var(--sp-2);
  margin-bottom: var(--sp-3);
  padding-bottom: var(--sp-2); border-bottom: 1px solid var(--border-subtle);
}
.section-title { font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.06em; color: var(--text-secondary); }

/* Game stats grid */
.stats-grid {
  display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--sp-2);
  margin-bottom: var(--sp-3);
}
.stat-chip {
  padding: var(--sp-2) var(--sp-3); background: var(--bg-surface-2);
  border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);
}
.stat-label { font-size: 10px; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 0.06em; margin-bottom: 2px; }
.stat-value { font-size: 14px; font-weight: 600; color: var(--text-primary); }

/* Oracle text */
.oracle-text {
  padding: var(--sp-3); background: var(--bg-surface-2); border-radius: var(--radius-md);
  border: 1px solid var(--border-subtle); font-size: 13px; line-height: 1.65;
  color: var(--text-secondary); font-style: italic; margin-bottom: var(--sp-2);
}
.flavor-text {
  padding: var(--sp-2) var(--sp-3); border-left: 2px solid var(--border-default);
  font-size: 12px; color: var(--text-tertiary); font-style: italic; line-height: 1.6;
}

/* Legality pills */
.legality-grid {
  display: flex; flex-wrap: wrap; gap: var(--sp-2);
}
.legality-pill {
  display: inline-flex; align-items: center; gap: 5px;
  padding: 4px 10px; border-radius: var(--radius-xl);
  font-size: 11px; font-weight: 600;
}
.legal   { background: rgba(74,222,128,0.10); color: var(--positive); border: 1px solid rgba(74,222,128,0.2); }
.banned  { background: rgba(239,83,80,0.10); color: var(--negative); border: 1px solid rgba(239,83,80,0.2); }
.illegal { background: rgba(255,255,255,0.05); color: var(--text-tertiary); border: 1px solid var(--border-subtle); }

/* ============================================================
   MARKETPLACE LISTINGS
   ============================================================ */
.listings-section {
  margin-top: var(--sp-6);
  background: var(--bg-surface-1);
  border-radius: var(--radius-lg);
  border: 1px solid var(--border-default);
  overflow: hidden;
}
.listings-header {
  display: flex; align-items: center; justify-content: space-between;
  padding: var(--sp-4) var(--sp-5);
  border-bottom: 1px solid var(--border-subtle);
}
.listings-title {
  font-size: 15px; font-weight: 700; color: var(--text-primary);
}
.listings-count {
  font-size: 12px; color: var(--text-secondary);
  background: var(--bg-surface-3); padding: 2px 10px; border-radius: var(--radius-xl);
}
.listings-sort-row {
  display: flex; align-items: center; gap: var(--sp-2); padding: var(--sp-3) var(--sp-5);
  background: var(--bg-surface-2); border-bottom: 1px solid var(--border-subtle);
}
.sort-label { font-size: 11px; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 0.06em; }
.sort-chip {
  padding: 3px 10px; border-radius: var(--radius-xl); font-size: 11px; font-weight: 500;
  background: transparent; border: 1px solid var(--border-default); color: var(--text-secondary);
  cursor: pointer; font-family: inherit;
}
.sort-chip.active { background: rgba(124,140,255,0.12); border-color: var(--interactive); color: var(--interactive); }

/* Listing row */
.listing-row {
  display: grid;
  grid-template-columns: 1fr auto auto auto;
  align-items: center; gap: var(--sp-4);
  padding: var(--sp-4) var(--sp-5);
  border-bottom: 1px solid var(--border-subtle);
  transition: background 0.15s;
}
.listing-row:last-child { border-bottom: none; }
.listing-row:hover { background: rgba(255,255,255,0.02); }

.seller-info {}
.seller-name { font-size: 13px; font-weight: 600; color: var(--text-primary); margin-bottom: 3px; }
.seller-trust {
  display: inline-flex; align-items: center; gap: 5px;
  font-size: 11px; color: var(--positive);
}
.seller-trust-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--positive); flex-shrink: 0; }
.seller-trust-text { color: var(--text-secondary); }
.seller-location { font-size: 11px; color: var(--text-tertiary); margin-top: 2px; }

.listing-condition {}
.condition-chip {
  display: inline-flex; padding: 3px 8px; border-radius: var(--radius-sm);
  font-size: 11px; font-weight: 700; letter-spacing: 0.04em; border: 1px solid;
}
.cond-nm { background: rgba(74,222,128,0.08); color: #4ADE80; border-color: rgba(74,222,128,0.2); }
.cond-lp { background: rgba(163,230,53,0.08); color: #A3E635; border-color: rgba(163,230,53,0.2); }
.cond-mp { background: rgba(251,191,36,0.08); color: var(--warning); border-color: rgba(251,191,36,0.2); }
.cond-hp { background: rgba(239,83,80,0.08); color: var(--negative); border-color: rgba(239,83,80,0.2); }

.listing-price-col { text-align: right; }
.listing-price { font-size: 17px; font-weight: 700; color: var(--text-price); font-family: 'SF Mono', Consolas, monospace; }
.listing-shipping { font-size: 11px; color: var(--text-tertiary); margin-top: 2px; }

.listing-actions {}

/* Degradation banner */
.listings-degraded-banner {
  display: flex; align-items: center; gap: var(--sp-3);
  padding: var(--sp-4) var(--sp-5);
  background: rgba(251,191,36,0.06); border-bottom: 1px solid rgba(251,191,36,0.15);
}
.degraded-icon { font-size: 18px; flex-shrink: 0; }
.degraded-text {}
.degraded-title { font-size: 13px; font-weight: 600; color: var(--warning); margin-bottom: 2px; }
.degraded-sub { font-size: 12px; color: var(--text-secondary); }

/* Empty state */
.listings-empty {
  padding: var(--sp-7) var(--sp-5);
  text-align: center;
}
.listings-empty-icon { font-size: 36px; margin-bottom: var(--sp-3); opacity: 0.4; }
.listings-empty-title { font-size: 15px; font-weight: 600; color: var(--text-primary); margin-bottom: var(--sp-2); }
.listings-empty-sub { font-size: 13px; color: var(--text-secondary); margin-bottom: var(--sp-4); }

/* Price summary bar */
.price-summary-bar {
  display: flex; align-items: center; gap: var(--sp-5); flex-wrap: wrap;
  padding: var(--sp-3) var(--sp-5);
  background: var(--bg-surface-2); border-top: 1px solid var(--border-subtle);
}
.price-summary-item {}
.price-summary-label { font-size: 10px; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 0.06em; }
.price-summary-value { font-size: 14px; font-weight: 700; color: var(--text-price); font-family: 'SF Mono', Consolas, monospace; margin-top: 1px; }

/* ============================================================
   COMPACT PRINTINGS TABLE
   ============================================================ */
.printings-table { width: 100%; border-collapse: collapse; }
.printings-table th {
  text-align: left; font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.06em;
  color: var(--text-tertiary); padding: var(--sp-2) var(--sp-3);
  border-bottom: 1px solid var(--border-subtle);
}
.printings-table td {
  padding: var(--sp-2) var(--sp-3); font-size: 12px; color: var(--text-secondary);
  border-bottom: 1px solid var(--border-subtle);
  cursor: pointer; transition: background 0.15s;
}
.printings-table tr:last-child td { border-bottom: none; }
.printings-table tr.selected td { background: rgba(212,168,67,0.06); color: var(--text-primary); }
.printings-table tr:hover td { background: rgba(255,255,255,0.02); }
.printings-table tr.selected .print-set-name { color: var(--accent-primary); font-weight: 600; }
.current-badge {
  display: inline-block; padding: 1px 6px; border-radius: var(--radius-sm);
  background: rgba(212,168,67,0.14); color: var(--accent-primary); font-size: 10px; font-weight: 600; margin-left: 6px;
}

/* Skeleton loading */
.skeleton {
  background: linear-gradient(90deg, var(--bg-surface-2) 25%, var(--bg-surface-3) 50%, var(--bg-surface-2) 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
  border-radius: var(--radius-sm);
}
@keyframes shimmer { to { background-position: -200% 0; } }
.skeleton-text { height: 12px; }
.skeleton-title { height: 18px; }
.skeleton-row { height: 60px; border-radius: 0; }

/* ============================================================
   MOBILE MOCK
   ============================================================ */
.mobile-frame {
  width: 390px; margin: 0 auto;
  background: var(--bg-base); border-radius: var(--radius-xl);
  border: 1px solid var(--border-default); overflow: hidden;
  box-shadow: 0 24px 64px rgba(0,0,0,0.6);
}
.mobile-statusbar {
  height: 44px; background: var(--bg-surface-1);
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 var(--sp-4); font-size: 12px; font-weight: 600; color: var(--text-primary);
}
.mobile-nav {
  padding: var(--sp-3) var(--sp-4);
  background: var(--bg-surface-1); border-bottom: 1px solid var(--border-subtle);
  display: flex; align-items: center; gap: var(--sp-3);
}
.mobile-back { font-size: 13px; color: var(--interactive); }
.mobile-nav-title { font-size: 15px; font-weight: 600; flex: 1; }
.mobile-content { padding: var(--sp-4); }
.mobile-card-hero {
  width: 100%; aspect-ratio: 63/88;
  background: linear-gradient(160deg, var(--bg-surface-2), var(--bg-surface-3));
  border-radius: var(--radius-md); border: 1px solid var(--border-subtle);
  display: flex; align-items: center; justify-content: center;
  font-size: 11px; color: var(--text-tertiary); margin-bottom: var(--sp-4);
  max-height: 340px;
}
.mobile-listing-row {
  display: flex; align-items: center; justify-content: space-between;
  padding: var(--sp-3); background: var(--bg-surface-2); border-radius: var(--radius-md);
  border: 1px solid var(--border-subtle); margin-bottom: var(--sp-2);
  gap: var(--sp-3);
}
.mobile-listing-left { flex: 1; }
.mobile-listing-right { display: flex; flex-direction: column; align-items: flex-end; gap: var(--sp-2); }
.mobile-add-btn {
  width: 100%; padding: var(--sp-3) var(--sp-4);
  background: var(--accent-primary); color: var(--bg-base);
  border: none; border-radius: var(--radius-sm); font-size: 13px; font-weight: 600;
  cursor: pointer; margin-top: var(--sp-1); font-family: inherit;
}

/* ============================================================
   SPACING HELPERS
   ============================================================ */
.mt-2 { margin-top: var(--sp-2); }
.mt-3 { margin-top: var(--sp-3); }
.mt-4 { margin-top: var(--sp-4); }
.mt-5 { margin-top: var(--sp-5); }
.mb-3 { margin-bottom: var(--sp-3); }
.text-sm { font-size: 12px; }
.text-xs { font-size: 11px; }
.text-secondary { color: var(--text-secondary); }
.text-tertiary { color: var(--text-tertiary); }
.divider { height: 1px; background: var(--border-subtle); margin: var(--sp-5) 0; }
</style>
</head>
<body>

<div class="wireframe-header">
  <h1>SideDecked ‚Äî Story <span>2-5</span>: Card Detail Page (BFF Endpoint)</h1>
  <p>Wireframe ¬∑ storefront ¬∑ 5 screens ¬∑ Phase 2B</p>
</div>

<div class="tab-nav">
  <button class="tab-btn active" onclick="showPanel('primary')">1 ¬∑ Primary (Loaded)</button>
  <button class="tab-btn" onclick="showPanel('degraded')">2 ¬∑ Degraded State</button>
  <button class="tab-btn" onclick="showPanel('empty')">3 ¬∑ Empty Listings</button>
  <button class="tab-btn" onclick="showPanel('loading')">4 ¬∑ Loading Skeleton</button>
  <button class="tab-btn" onclick="showPanel('mobile')">5 ¬∑ Mobile View</button>
  <button class="tab-btn" onclick="showPanel('edge')">6 ¬∑ Edge Cases</button>
</div>

<div class="panels">

  <!-- ======================================================
       PANEL 1: PRIMARY STATE ‚Äî Catalog + Real Listings Loaded
       ====================================================== -->
  <div id="panel-primary" class="panel active">
    <div class="panel-label">Screen 1</div>
    <div class="panel-title">Card Detail Page ‚Äî Primary (Loaded) State</div>
    <div class="panel-desc">
      BFF has successfully aggregated catalog data from customer-backend AND active listings from backend.
      Trust scores have been enriched via the third parallel call to customer-backend.
      <br><br>
      <strong>Components:</strong> CardDetailPage (client) ‚Üê page.tsx (server, ISR revalidate:30) ‚Üê /api/cards/[id] BFF route
    </div>

    <div class="annotation">
      <strong>AC1 ‚Äî BFF Aggregation:</strong> The storefront BFF at <code>/api/cards/[id]</code> runs three parallel calls:
      (1) <code>GET customer-backend:7000/api/cards/:id/details</code> for catalog,
      (2) <code>GET backend:9001/store/products?metadata[catalog_sku]=...</code> for listings,
      (3) <code>GET customer-backend:7000/api/sellers/:id/trust</code> for trust enrichment per seller.
      All wrapped in <code>Promise.allSettled</code>. Listings or trust failure = graceful degrade only.
    </div>

    <!-- Card detail grid -->
    <div class="card-detail-grid mt-4">

      <!-- LEFT: Card image + printings -->
      <div class="card-image-column">
        <div class="card-image-hero">
          <div class="card-image-hero-inner">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <rect x="3" y="3" width="18" height="18" rx="3"/>
              <circle cx="9" cy="9" r="1.5"/>
              <path d="m21 15-6-6L3 21"/>
            </svg>
            Card Image<br><span style="font-size:10px">63√ó88 aspect ¬∑ full-bleed hero</span>
          </div>
          <div class="card-image-overlay">
            <span class="card-foil-badge">‚ú¶ Foil</span>
          </div>
        </div>

        <div class="annotation text-xs">
          <strong>AC2:</strong> Full-bleed card image. <code>selectedPrint</code> state in CardDetailPage controls which print image is shown.
          The foil badge appears when <code>print.finish === 'foil'</code>.
        </div>

        <!-- Printings table -->
        <div class="section">
          <div class="section-header">
            <span class="section-title">Other Printings</span>
          </div>
          <div class="annotation-blue annotation text-xs mb-3">
            <strong>AC5 + Decision Q2-B:</strong> Clicking a row updates <code>selectedPrint</code> state client-side.
            URL stays as <code>/cards/:cardId</code>. Selected row highlighted with gold accent.
            <code>currentPrintId</code> prop on CompactPrintingsTable determines which row is "current".
          </div>
          <table class="printings-table">
            <thead>
              <tr>
                <th>Set</th>
                <th>Year</th>
                <th>Rarity</th>
                <th>#</th>
              </tr>
            </thead>
            <tbody>
              <tr class="selected">
                <td class="print-set-name">
                  Murders at Karlov Manor
                  <span class="current-badge">Current</span>
                </td>
                <td>2024</td>
                <td><span class="badge badge-rare"><span class="rarity-dot dot-rare"></span>Rare</span></td>
                <td>242</td>
              </tr>
              <tr>
                <td class="print-set-name">Streets of New Capenna</td>
                <td>2022</td>
                <td><span class="badge badge-rare"><span class="rarity-dot dot-rare"></span>Rare</span></td>
                <td>187</td>
              </tr>
              <tr>
                <td class="print-set-name">Double Masters 2022</td>
                <td>2022</td>
                <td><span class="badge badge-rare"><span class="rarity-dot dot-rare"></span>Rare</span></td>
                <td>056</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- RIGHT: Card info + stats + legality + listings -->
      <div class="card-detail-content">
        <div class="card-game-row">
          <span class="badge badge-mtg">MTG</span>
          <span class="badge badge-rare"><span class="rarity-dot dot-rare"></span>Rare</span>
        </div>
        <div class="card-name">Atraxa, Praetors' Voice</div>
        <div class="card-type-line">Legendary Creature ‚Äî Phyrexian Angel Horror</div>

        <div class="card-set-info">
          <div class="card-set-icon">üèõ</div>
          <div>
            <div class="set-name">Murders at Karlov Manor</div>
            <div class="set-meta">MKM ¬∑ #242/291 ¬∑ 2024 ¬∑ Eng</div>
          </div>
        </div>

        <!-- Game stats (MTG: P/T, mana) -->
        <div class="section">
          <div class="section-header"><span class="section-title">Stats</span></div>
          <div class="stats-grid">
            <div class="stat-chip">
              <div class="stat-label">Mana Cost</div>
              <div class="stat-value">{W}{U}{B}{G}</div>
            </div>
            <div class="stat-chip">
              <div class="stat-label">Mana Value</div>
              <div class="stat-value">4</div>
            </div>
            <div class="stat-chip">
              <div class="stat-label">Power / Toughness</div>
              <div class="stat-value">4 / 4</div>
            </div>
          </div>
          <div class="oracle-text">
            Flying, deathtouch, lifelink, vigilance<br>
            At the beginning of your end step, proliferate.
          </div>
          <div class="flavor-text">"Completion is the greatest mercy we can offer."</div>
          <div class="annotation text-xs mt-2">
            <strong>AC2 ‚Äî Game-specific attrs:</strong> <code>GameStatsDisplay</code> component handles game branching via <code>card.gameCode</code>.
            MTG shows: manaCost, manaValue, power/toughness. Pok√©mon: HP, retreat, energy type. YGO: ATK/DEF/Level. OP: Cost/Power.
          </div>
        </div>

        <!-- Format legality -->
        <div class="section">
          <div class="section-header"><span class="section-title">Format Legality</span></div>
          <div class="legality-grid">
            <span class="legality-pill legal">‚úì Commander</span>
            <span class="legality-pill legal">‚úì Modern</span>
            <span class="legality-pill legal">‚úì Legacy</span>
            <span class="legality-pill banned">‚úó Vintage</span>
            <span class="legality-pill illegal">‚Äî Standard</span>
            <span class="legality-pill illegal">‚Äî Pioneer</span>
          </div>
          <div class="annotation text-xs mt-2">
            <strong>AC2 ‚Äî Legality:</strong> Sourced from <code>card.prints[selectedIndex].legality</code> in the BFF response.
            FormatLegalityGrid component renders pills. <code>FormatLegalityGrid.tsx</code> already handles this.
          </div>
        </div>
      </div>
    </div>

    <!-- LISTINGS SECTION ‚Äî full width below grid -->
    <div class="listings-section mt-5">
      <div class="listings-header">
        <div>
          <div class="listings-title">Active Listings</div>
        </div>
        <span class="listings-count">12 sellers</span>
      </div>
      <div class="listings-sort-row">
        <span class="sort-label">Sort:</span>
        <button class="sort-chip active">Price ‚Üë</button>
        <button class="sort-chip">Condition</button>
        <button class="sort-chip">Seller Rating</button>
      </div>

      <div class="annotation mt-3" style="margin:0 var(--sp-5) 0;border-radius:0;border-left:none;border-right:none;border-top:none;">
        <strong>AC3 ‚Äî Seller Row Anatomy:</strong> Each row: seller name + trust signal ("99.2% positive ¬∑ 412 sales" format per UX spec) + condition chip + price (sorted by price asc, then NM&gt;LP&gt;MP&gt;HP) + shipping est + "Add to Cart" button.
        Trust data from third parallel BFF call to <code>customer-backend /api/sellers/:id/trust</code> (Q1: Decision A).
        "Add to Cart" is visible and styled but non-functional in this story ‚Äî Cart is Epic 5.
      </div>

      <!-- Listing row 1 ‚Äî NM, best price -->
      <div class="listing-row">
        <div class="seller-info">
          <div class="seller-name">CardVault Toronto</div>
          <div class="seller-trust">
            <span class="seller-trust-dot"></span>
            <span>99.2% positive</span>
            <span class="seller-trust-text">¬∑ 412 sales</span>
          </div>
          <div class="seller-location">Ships from Toronto, ON</div>
        </div>
        <div class="listing-condition">
          <span class="condition-chip cond-nm">NM</span>
          <div class="text-xs text-tertiary mt-2">English</div>
        </div>
        <div class="listing-price-col">
          <div class="listing-price">$14.99</div>
          <div class="listing-shipping">+ $1.50 shipping</div>
        </div>
        <div class="listing-actions">
          <button class="gold-btn" onclick="showCartToast(this,'CardVault Toronto','NM','$14.99')" aria-label="Add to Cart from CardVault Toronto, Near Mint, $14.99">Add to Cart</button>
        </div>
      </div>

      <!-- Listing row 2 ‚Äî LP -->
      <div class="listing-row">
        <div class="seller-info">
          <div class="seller-name">MidnightForge Shop</div>
          <div class="seller-trust">
            <span class="seller-trust-dot"></span>
            <span>97.8% positive</span>
            <span class="seller-trust-text">¬∑ 1,204 sales</span>
          </div>
          <div class="seller-location">Ships from Vancouver, BC</div>
        </div>
        <div class="listing-condition">
          <span class="condition-chip cond-lp">LP</span>
          <div class="text-xs text-tertiary mt-2">English</div>
        </div>
        <div class="listing-price-col">
          <div class="listing-price">$12.50</div>
          <div class="listing-shipping">Free shipping</div>
        </div>
        <div class="listing-actions">
          <button class="gold-btn" onclick="showCartToast(this,'MidnightForge Shop','LP','$12.50')" aria-label="Add to Cart from MidnightForge Shop, Lightly Played, $12.50">Add to Cart</button>
        </div>
      </div>

      <!-- Listing row 3 ‚Äî MP ‚Äî no trust data available (fallback: omit trust line) -->
      <div class="listing-row">
        <div class="seller-info">
          <div class="seller-name">TCG Deals CA</div>
          <!-- No trust data: trust line omitted entirely, not shown as broken -->
          <div class="seller-location" style="margin-top:3px">Ships from Calgary, AB ¬∑ New seller</div>
        </div>
        <div class="listing-condition">
          <span class="condition-chip cond-mp">MP</span>
          <div class="text-xs text-tertiary mt-2">English</div>
        </div>
        <div class="listing-price-col">
          <div class="listing-price">$10.00</div>
          <div class="listing-shipping">+ $2.00 shipping</div>
        </div>
        <div class="listing-actions">
          <button class="gold-btn" onclick="showCartToast(this,'TCG Deals CA','MP','$10.00')" aria-label="Add to Cart from TCG Deals CA, Moderately Played, $10.00">Add to Cart</button>
        </div>
      </div>

      <!-- Price summary bar -->
      <div class="price-summary-bar">
        <div class="price-summary-item">
          <div class="price-summary-label">Lowest NM</div>
          <div class="price-summary-value">$14.99</div>
        </div>
        <div class="price-summary-item">
          <div class="price-summary-label">Market Avg</div>
          <div class="price-summary-value">$16.20</div>
        </div>
        <div class="price-summary-item">
          <div class="price-summary-label">Sellers</div>
          <div class="price-summary-value" style="color:var(--text-secondary);font-family:inherit">12</div>
        </div>
      </div>
    </div>

    <div class="annotation annotation-blue mt-4">
      <strong>Print-switch ‚Üí listings re-fetch:</strong> When user clicks a different row in CompactPrintingsTable,
      <code>selectedPrint</code> state updates in CardDetailPage (client component). The MarketplaceListingsSection
      must react to <code>selectedPrint</code> changes and re-fetch listings for the new <code>catalogSku</code>
      (derived from new print's set.code + print.number). Implement via <code>useEffect</code> watching <code>selectedPrint.id</code>.
    </div>
  </div>

  <!-- ======================================================
       PANEL 2: DEGRADED STATE ‚Äî Backend Listings Unavailable
       ====================================================== -->
  <div id="panel-degraded" class="panel">
    <div class="panel-label">Screen 2</div>
    <div class="panel-title">Card Detail Page ‚Äî Degraded State (Listings Unavailable)</div>
    <div class="panel-desc">
      The backend (mercur-db) is temporarily unavailable or timed out (3s AbortController).
      Catalog data from customer-backend still renders normally.
      The BFF returns <code>listingsUnavailable: true</code>, <code>listings: []</code>.
    </div>

    <div class="annotation">
      <strong>AC4 ‚Äî Circuit Breaker:</strong> When <code>backend:9001/store/products</code> returns error or times out:
      BFF catches via <code>Promise.allSettled</code>, sets <code>listingsUnavailable: true</code>.
      Catalog renders normally. MarketplaceListingsSection detects the flag and shows the degradation banner below.
      No raw errors, no blame ‚Äî empathetic copy per UX spec.
    </div>

    <!-- Catalog renders exactly the same ‚Äî abbreviated for wireframe -->
    <div style="background:var(--bg-surface-1);border:1px solid var(--border-subtle);border-radius:var(--radius-lg);padding:var(--sp-5);margin-top:var(--sp-4)">
      <div class="text-secondary text-sm" style="text-align:center;padding:var(--sp-3) 0;">
        [Catalog section renders normally ‚Äî same as Screen 1. Card image, name, stats, legality all present.]
      </div>
    </div>

    <!-- Listings section ‚Äî degraded -->
    <div class="listings-section mt-5">
      <div class="listings-header">
        <div class="listings-title">Active Listings</div>
      </div>

      <!-- Degradation banner -->
      <div class="listings-degraded-banner">
        <div class="degraded-icon">‚ö†</div>
        <div class="degraded-text">
          <div class="degraded-title">Seller listings are temporarily unavailable</div>
          <div class="degraded-sub">Check back in a few minutes. Card information is up to date.</div>
        </div>
      </div>

      <!-- Empty body with retry CTA -->
      <div class="listings-empty" style="padding-top:var(--sp-5)">
        <div class="listings-empty-icon">üì¶</div>
        <div class="listings-empty-title">Can't load listings right now</div>
        <div class="listings-empty-sub">We're having trouble reaching our listing database. This is temporary.</div>
        <button class="ghost-btn" style="margin:0 auto">‚Ü∫ Try again</button>
      </div>
    </div>

    <div class="annotation annotation-blue mt-4">
      <strong>Implementation note:</strong> The "Try again" button triggers a client-side refetch of <code>/api/cards/:id</code>.
      Since <code>listingsUnavailable: true</code> is a BFF flag (not a render error), the retry should re-call the BFF route
      rather than refreshing the page. Implement as a <code>router.refresh()</code> or a client fetch with state update.
      The catalog section must NOT re-render on retry ‚Äî only the listings section should update.
    </div>
  </div>

  <!-- ======================================================
       PANEL 3: EMPTY LISTINGS ‚Äî Card exists, zero sellers
       ====================================================== -->
  <div id="panel-empty" class="panel">
    <div class="panel-label">Screen 3</div>
    <div class="panel-title">Card Detail Page ‚Äî Empty Listings State</div>
    <div class="panel-desc">
      The backend is online and responds successfully, but returns zero active listings for this card's catalog SKU.
      <code>listings: []</code>, <code>listingsUnavailable: false</code>.
      This is distinct from the degraded state ‚Äî the system is healthy, the card just has no sellers.
    </div>

    <div class="annotation">
      <strong>BA Edge Case:</strong> Empty listings (no sellers) vs unavailable listings (system down) must be visually
      distinct. Empty state is a normal product state ‚Äî some cards have no current sellers. The messaging should invite
      action (wishlist/price alert) rather than suggesting a problem.
    </div>

    <div style="background:var(--bg-surface-1);border:1px solid var(--border-subtle);border-radius:var(--radius-lg);padding:var(--sp-5);margin-top:var(--sp-4)">
      <div class="text-secondary text-sm" style="text-align:center;padding:var(--sp-3) 0;">
        [Catalog section renders normally.]
      </div>
    </div>

    <div class="listings-section mt-5">
      <div class="listings-header">
        <div class="listings-title">Active Listings</div>
        <span class="listings-count">0 sellers</span>
      </div>

      <div class="listings-empty">
        <div class="listings-empty-icon">üîç</div>
        <div class="listings-empty-title">No listings available right now</div>
        <div class="listings-empty-sub">
          No sellers are currently listing this card. Want to know when one appears?
        </div>
        <!-- Auth-aware CTA ‚Äî two variants based on auth state -->
        <div style="display:flex;flex-direction:column;align-items:center;gap:var(--sp-2)">
          <!-- Variant A: Authenticated user ‚Äî stub CTA (Epic 2-8) -->
          <button class="gold-btn" onclick="showToast('Price alerts coming in a future update!')" style="opacity:0.6" aria-label="Get notified when a listing is available ‚Äî coming soon">
            üîî Notify me when available
          </button>
          <div class="text-xs text-tertiary">Price alerts ¬∑ Coming in story 2-8</div>
          <div class="divider" style="width:200px"></div>
          <!-- Variant B: Unauthenticated user ‚Äî sign-in prompt -->
          <div class="text-sm text-secondary" style="text-align:center">
            <span style="color:var(--interactive);cursor:pointer;text-decoration:underline">Sign in</span>
            &nbsp;to get notified when a listing appears
          </div>
        </div>
      </div>
    </div>

    <div class="annotation annotation-blue mt-4">
      <strong>Scope note:</strong> "Notify me when available" CTA is included as a disabled stub in this story.
      The wishlist/price-tracking story (2-8) will activate it. In this story, render it greyed-out with a tooltip
      "Price alert feature coming soon" ‚Äî do not wire up any backend call for notifications.
    </div>
  </div>

  <!-- ======================================================
       PANEL 4: LOADING SKELETON
       ====================================================== -->
  <div id="panel-loading" class="panel">
    <div class="panel-label">Screen 4</div>
    <div class="panel-title">Card Detail Page ‚Äî Loading Skeleton</div>
    <div class="panel-desc">
      Shown during client-side re-validation (ISR stale check) or when the user triggers a listings retry.
      The page structure is fully rendered via ISR ‚Äî the skeleton appears only in the listings section during re-fetch.
      The catalog section never shows a skeleton (it's SSR/ISR rendered).
    </div>

    <div class="annotation">
      <strong>ISR Strategy:</strong> <code>page.tsx</code> uses <code>export const revalidate = 30</code>.
      Catalog fetch uses <code>next: &#123; revalidate: 300 &#125;</code>. Listings fetch uses <code>next: &#123; revalidate: 30 &#125;</code>.
      The skeleton below is only for the listings re-fetch triggered client-side (print switch or retry).
    </div>

    <div class="annotation annotation-blue mt-3">
      <strong>Catalog is ISR-rendered ‚Äî never skeletons.</strong>
      The card name, image, stats, and legality are rendered by the server component (ISR).
      When the page first loads or the user switches prints and triggers a listings re-fetch,
      only the listings section shows a skeleton. The catalog section below renders normally.
    </div>

    <!-- Catalog section renders normally (ISR pre-rendered) -->
    <div class="card-detail-grid mt-4">
      <div>
        <div class="card-image-hero">
          <div class="card-image-hero-inner">
            <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <rect x="3" y="3" width="18" height="18" rx="3"/><circle cx="9" cy="9" r="1.5"/><path d="m21 15-6-6L3 21"/>
            </svg>
            Card Image<br><span style="font-size:10px">Already loaded (SSR)</span>
          </div>
        </div>
        <div class="section">
          <div class="section-header"><span class="section-title">Other Printings</span></div>
          <table class="printings-table">
            <tbody>
              <tr class="selected"><td class="print-set-name">Murders at Karlov Manor <span class="current-badge">Current</span></td><td>2024</td><td><span class="badge badge-rare">Rare</span></td><td>242</td></tr>
              <tr><td class="print-set-name">Streets of New Capenna</td><td>2022</td><td><span class="badge badge-rare">Rare</span></td><td>187</td></tr>
            </tbody>
          </table>
        </div>
      </div>
      <div>
        <div class="card-game-row"><span class="badge badge-mtg">MTG</span><span class="badge badge-rare"><span class="rarity-dot dot-rare"></span>Rare</span></div>
        <div class="card-name" style="font-size:22px">Atraxa, Praetors' Voice</div>
        <div class="card-type-line">Legendary Creature ‚Äî Phyrexian Angel Horror</div>
        <div class="card-set-info mt-3">
          <div class="card-set-icon">üèõ</div>
          <div><div class="set-name">Murders at Karlov Manor</div><div class="set-meta">MKM ¬∑ #242 ¬∑ 2024</div></div>
        </div>
        <div class="stats-grid mt-3">
          <div class="stat-chip"><div class="stat-label">Mana</div><div class="stat-value">{W}{U}{B}{G}</div></div>
          <div class="stat-chip"><div class="stat-label">Mana Value</div><div class="stat-value">4</div></div>
          <div class="stat-chip"><div class="stat-label">P/T</div><div class="stat-value">4 / 4</div></div>
        </div>
      </div>
    </div>

    <!-- Listings skeleton -->
    <div class="listings-section mt-5">
      <div class="listings-header">
        <div class="skeleton skeleton-text" style="width:120px"></div>
        <div class="skeleton skeleton-text" style="width:60px"></div>
      </div>
      <div class="listing-row skeleton-row" style="border-radius:0"></div>
      <div class="listing-row skeleton-row" style="border-radius:0"></div>
      <div class="listing-row skeleton-row" style="border-radius:0;border-bottom:none"></div>
    </div>

    <div class="annotation annotation-blue mt-4">
      <strong>Implementation:</strong> Use Tailwind's <code>animate-pulse</code> on placeholder divs within
      <code>MarketplaceListingsSection</code>. Show skeleton only when <code>isLoadingListings === true</code>
      (client state during re-fetch). Never show full-page skeleton ‚Äî catalog is always available.
    </div>
  </div>

  <!-- ======================================================
       PANEL 5: MOBILE VIEW (390px)
       ====================================================== -->
  <div id="panel-mobile" class="panel">
    <div class="panel-label">Screen 5</div>
    <div class="panel-title">Mobile View ‚Äî 390px (iPhone 15 viewport)</div>
    <div class="panel-desc">
      Single-column layout. Card image stacks above content. Listings become card-style rows.
      "Add to Cart" button is full-width on each listing row. Grid collapses to 1 column.
    </div>

    <div class="annotation mb-3">
      <strong>Mobile constraints from UX spec:</strong> No hover-gated interactions ‚Äî every element must be tappable.
      Min touch target: 44√ó44px. "Add to Cart" must be full-width on mobile, not inline.
      Trust signal fits on one line: "99.2% ¬∑ 412 sales" (abbreviated).
    </div>

    <div class="mobile-frame">
      <div class="mobile-statusbar">
        <span>9:41</span>
        <span>‚óè‚óè‚óè‚óè</span>
      </div>
      <div class="mobile-nav">
        <span class="mobile-back">‚Üê Search</span>
        <span class="mobile-nav-title">Card Detail</span>
        <button class="ghost-btn" style="font-size:11px;padding:4px 10px;">Share</button>
      </div>
      <div class="mobile-content">
        <!-- Card image -->
        <div class="mobile-card-hero">Card Image ¬∑ Full Bleed</div>

        <!-- Card identity -->
        <div style="margin-bottom:var(--sp-4)">
          <div style="display:flex;gap:var(--sp-2);margin-bottom:var(--sp-2)">
            <span class="badge badge-mtg">MTG</span>
            <span class="badge badge-rare"><span class="rarity-dot dot-rare"></span>Rare</span>
          </div>
          <div style="font-size:20px;font-weight:800;letter-spacing:-0.02em;margin-bottom:4px">Atraxa, Praetors' Voice</div>
          <div class="text-secondary text-sm">Legendary Creature ‚Äî Phyrexian Angel</div>
          <div class="text-sm" style="margin-top:var(--sp-2);color:var(--text-tertiary)">Murders at Karlov Manor ¬∑ MKM #242</div>
        </div>

        <!-- Stats (2-col on mobile) -->
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:var(--sp-2);margin-bottom:var(--sp-4)">
          <div class="stat-chip"><div class="stat-label">Mana</div><div class="stat-value">{W}{U}{B}{G}</div></div>
          <div class="stat-chip"><div class="stat-label">P/T</div><div class="stat-value">4 / 4</div></div>
        </div>

        <!-- Format legality (scrollable row) -->
        <div style="overflow-x:auto;padding-bottom:var(--sp-2);margin-bottom:var(--sp-4)">
          <div style="display:flex;gap:var(--sp-2);width:max-content">
            <span class="legality-pill legal">‚úì Commander</span>
            <span class="legality-pill legal">‚úì Modern</span>
            <span class="legality-pill legal">‚úì Legacy</span>
            <span class="legality-pill banned">‚úó Vintage</span>
          </div>
        </div>

        <div class="divider"></div>

        <!-- Listings section on mobile -->
        <div style="margin-bottom:var(--sp-3)">
          <div style="font-size:14px;font-weight:700;margin-bottom:var(--sp-3)">Active Listings <span style="font-size:12px;color:var(--text-secondary)">¬∑ 12 sellers</span></div>

          <!-- Listing card row 1 -->
          <div class="mobile-listing-row">
            <div class="mobile-listing-left">
              <div style="font-size:13px;font-weight:600;margin-bottom:3px">CardVault Toronto</div>
              <div style="font-size:11px;color:var(--positive)">‚óè 99.2% ¬∑ 412 sales</div>
              <div style="margin-top:var(--sp-2);display:flex;align-items:center;gap:var(--sp-2)">
                <span class="condition-chip cond-nm">NM</span>
                <span class="text-xs text-tertiary">Eng</span>
              </div>
              <button class="mobile-add-btn" disabled>Add to Cart ‚Äî $14.99</button>
            </div>
          </div>

          <!-- Listing card row 2 -->
          <div class="mobile-listing-row">
            <div class="mobile-listing-left">
              <div style="font-size:13px;font-weight:600;margin-bottom:3px">MidnightForge Shop</div>
              <div style="font-size:11px;color:var(--positive)">‚óè 97.8% ¬∑ 1,204 sales</div>
              <div style="margin-top:var(--sp-2);display:flex;align-items:center;gap:var(--sp-2)">
                <span class="condition-chip cond-lp">LP</span>
                <span class="text-xs text-tertiary">Eng ¬∑ Free shipping</span>
              </div>
              <button class="mobile-add-btn" disabled>Add to Cart ‚Äî $12.50</button>
            </div>
          </div>
        </div>

        <!-- Printings (collapsible on mobile) -->
        <div style="border:1px solid var(--border-subtle);border-radius:var(--radius-md);padding:var(--sp-3)">
          <div style="display:flex;justify-content:space-between;align-items:center;cursor:pointer">
            <span style="font-size:13px;font-weight:600">Other Printings (3)</span>
            <span class="text-secondary">‚ñæ</span>
          </div>
          <div style="font-size:11px;color:var(--text-tertiary);margin-top:var(--sp-2)">
            [Collapsed on mobile by default ‚Äî tap to expand]
          </div>
        </div>
      </div>
    </div>

    <div class="annotation annotation-blue mt-4">
      <strong>Mobile implementation notes:</strong>
      (1) <code>card-detail-grid</code> uses <code>grid-template-columns: 1fr</code> below <code>md:</code> breakpoint (768px).
      (2) Listings use card layout (<code>flex-col</code>) instead of table row on mobile ‚Äî "Add to Cart" is full-width inside card.
      (3) Format legality pills use <code>overflow-x: auto</code> horizontal scroll on mobile.
      (4) Printings table collapses with a disclosure toggle on mobile (shadcn <code>Collapsible</code> component).
      (5) All touch targets ‚â• 44px ‚Äî verified especially on condition chips and sort controls.
    </div>
  </div>

  <!-- ======================================================
       PANEL 6: EDGE CASES (Advanced Elicitation)
       ====================================================== -->
  <div id="panel-edge" class="panel">
    <div class="panel-label">Screen 6</div>
    <div class="panel-title">Advanced Elicitation ‚Äî Edge Cases &amp; Missing States</div>
    <div class="panel-desc">
      Surfaced via advanced elicitation: error states, extreme data, accessibility, post-action feedback.
      These scenarios must be handled in implementation even if not explicitly shown in Screens 1‚Äì5.
    </div>

    <!-- What happens when... -->
    <div class="section-header mt-4"><span class="section-title">What happens when‚Ä¶?</span></div>

    <div style="display:grid;grid-template-columns:1fr 1fr;gap:var(--sp-4);margin-top:var(--sp-3)">

      <!-- Card image fails to load -->
      <div style="background:var(--bg-surface-2);border:1px solid var(--border-subtle);border-radius:var(--radius-md);padding:var(--sp-4)">
        <div style="font-size:12px;font-weight:600;color:var(--warning);margin-bottom:var(--sp-2)">‚ö† Card image fails to load</div>
        <div class="card-image-hero" style="height:160px;aspect-ratio:auto">
          <div class="card-image-hero-inner">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="opacity:0.3;margin-bottom:6px"><rect x="3" y="3" width="18" height="18" rx="3"/><circle cx="9" cy="9" r="1.5"/><path d="m21 15-6-6L3 21"/></svg>
            <span style="font-size:11px">Atraxa, Praetors' Voice</span><br>
            <span style="font-size:10px;color:var(--text-tertiary)">Image unavailable</span>
          </div>
        </div>
        <div class="annotation text-xs mt-2">
          <strong>Implementation:</strong> Use Next.js <code>&lt;Image&gt;</code> with <code>onError</code> handler ‚Üí
          show card name centred in placeholder div. Do NOT show a broken image icon. Background:
          <code>linear-gradient(160deg, var(--bg-surface-2), var(--bg-surface-3))</code>.
        </div>
      </div>

      <!-- Very long seller name -->
      <div style="background:var(--bg-surface-2);border:1px solid var(--border-subtle);border-radius:var(--radius-md);padding:var(--sp-4)">
        <div style="font-size:12px;font-weight:600;color:var(--warning);margin-bottom:var(--sp-2)">‚ö† Very long seller / card name</div>
        <div class="listing-row" style="padding:var(--sp-3);background:var(--bg-surface-3);border-radius:var(--radius-sm)">
          <div class="seller-info">
            <div class="seller-name" style="overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:160px">
              VeryLongBusinessNameThatExceedsColumnWidth
            </div>
            <div class="seller-trust"><span class="seller-trust-dot"></span><span>98.5% positive</span><span class="seller-trust-text">¬∑ 234 sales</span></div>
          </div>
          <div class="listing-condition"><span class="condition-chip cond-nm">NM</span></div>
          <div class="listing-price-col"><div class="listing-price">$14.99</div></div>
          <div class="listing-actions"><button class="gold-btn" onclick="showCartToast(this,'Seller','NM','$14.99')" style="font-size:11px;padding:6px 10px">Add to Cart</button></div>
        </div>
        <div class="annotation text-xs mt-2">
          <strong>Implementation:</strong> Seller name cell: <code>overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 200px</code>.
          Card name on detail header: allow wrap (2 lines max). Do NOT truncate card name ‚Äî it's the h1.
        </div>
      </div>

      <!-- 50+ listings -->
      <div style="background:var(--bg-surface-2);border:1px solid var(--border-subtle);border-radius:var(--radius-md);padding:var(--sp-4)">
        <div style="font-size:12px;font-weight:600;color:var(--warning);margin-bottom:var(--sp-2)">‚ö† 50+ listings (popular card)</div>
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:var(--sp-3)">
          <span class="listings-title" style="font-size:13px">Active Listings</span>
          <span class="listings-count">87 sellers</span>
        </div>
        <div style="font-size:12px;color:var(--text-secondary);margin-bottom:var(--sp-2)">[Rows 1‚Äì20 shown]</div>
        <div style="display:flex;justify-content:center;gap:var(--sp-2);padding:var(--sp-3) 0;border-top:1px solid var(--border-subtle)">
          <button class="ghost-btn">‚Üê Prev</button>
          <span style="font-size:12px;color:var(--text-secondary);padding:6px 12px;background:var(--bg-surface-3);border-radius:var(--radius-sm)">Page 1 / 5</span>
          <button class="ghost-btn">Next ‚Üí</button>
        </div>
        <div class="annotation text-xs mt-2">
          <strong>Implementation:</strong> Paginate at 20 rows. Show page controls when <code>listings.length &gt; 20</code>.
          Alternative: virtual scroll (react-virtual) if performance testing shows DOM cost.
          Default: simple pagination ‚Äî avoid over-engineering. Client-side pagination of the BFF response array.
        </div>
      </div>

      <!-- Batch trust endpoint annotation -->
      <div style="background:var(--bg-surface-2);border:1px solid var(--border-subtle);border-radius:var(--radius-md);padding:var(--sp-4)">
        <div style="font-size:12px;font-weight:600;color:var(--interactive);margin-bottom:var(--sp-2)">üèó Batch Trust Call (Winston + Amelia fix)</div>
        <div style="font-family:monospace;font-size:11px;background:var(--bg-base);padding:var(--sp-3);border-radius:var(--radius-sm);color:var(--text-secondary);line-height:1.8">
          <span style="color:var(--negative)">// ‚úó BAD ‚Äî N individual calls</span><br>
          listings.forEach(l =&gt; fetch('/api/sellers/'+l.sellerId+'/trust'))<br><br>
          <span style="color:var(--positive)">// ‚úì GOOD ‚Äî single batch call</span><br>
          <span style="color:var(--interactive)">POST</span> /api/sellers/trust/batch<br>
          Body: <span style="color:var(--accent-primary)">&#123; sellerIds: string[] &#125;</span><br>
          Returns: <span style="color:var(--accent-primary)">Map&lt;sellerId, TrustScore&gt;</span>
        </div>
        <div class="annotation text-xs mt-2">
          <strong>Required:</strong> If <code>POST /api/sellers/trust/batch</code> doesn't exist in customer-backend,
          Task 4 must include creating it. BFF service calls it once per page load after receiving the listings array.
          Dedup seller IDs before calling: <code>[...new Set(listings.map(l =&gt; l.sellerId))]</code>.
        </div>
      </div>

    </div>

    <!-- What does the user expect after... -->
    <div class="section-header mt-5"><span class="section-title">What does the user expect after‚Ä¶?</span></div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:var(--sp-4);margin-top:var(--sp-3)">

      <!-- After clicking Add to Cart (toast) -->
      <div style="background:var(--bg-surface-2);border:1px solid var(--border-subtle);border-radius:var(--radius-md);padding:var(--sp-4)">
        <div style="font-size:12px;font-weight:600;color:var(--text-primary);margin-bottom:var(--sp-2)">After clicking "Add to Cart"</div>
        <!-- Toast mock -->
        <div style="background:var(--bg-surface-4);border:1px solid var(--border-default);border-radius:var(--radius-md);padding:var(--sp-3) var(--sp-4);display:flex;align-items:flex-start;gap:var(--sp-3)">
          <span style="font-size:18px;flex-shrink:0">üõí</span>
          <div>
            <div style="font-size:13px;font-weight:600;color:var(--text-primary)">Cart coming soon</div>
            <div style="font-size:12px;color:var(--text-secondary);margin-top:2px">We're building multi-vendor checkout. You'll be the first to know.</div>
          </div>
        </div>
        <div class="annotation text-xs mt-2">
          <strong>Implementation:</strong> Use <code>sonner</code> toast (already in storefront deps).
          <code>toast('Cart coming soon', &#123; description: '...' &#125;)</code>. The button must NOT be <code>disabled</code> ‚Äî
          it should be fully styled and clickable. This follows UX spec: no broken-looking UI for future features.
        </div>
        <div style="margin-top:var(--sp-3)">
          <button class="gold-btn" onclick="showCartToast(this,'Demo','NM','$14.99')">Try it ‚Üí Add to Cart</button>
        </div>
      </div>

      <!-- After switching print -->
      <div style="background:var(--bg-surface-2);border:1px solid var(--border-subtle);border-radius:var(--radius-md);padding:var(--sp-4)">
        <div style="font-size:12px;font-weight:600;color:var(--text-primary);margin-bottom:var(--sp-2)">After clicking a different printing</div>
        <div style="font-size:12px;color:var(--text-secondary);line-height:1.7;margin-bottom:var(--sp-3)">
          1. <code>selectedPrint</code> state updates ‚Üí card image swaps<br>
          2. <code>catalogSku</code> recomputed from new print<br>
          3. Listings section shows skeleton (fetch in progress)<br>
          4. BFF called: <code>/api/cards/:id?catalogSku=:sku</code><br>
          5. Listings section re-renders with new results<br>
          6. If new print has 0 listings ‚Üí empty state shown<br>
          7. URL does NOT change (client state only ‚Äî Decision Q2-B)
        </div>
        <div class="annotation text-xs">
          <strong>Implementation:</strong> <code>useEffect(() =&gt; &#123; fetchListings(selectedPrint) &#125;, [selectedPrint?.id])</code>.
          Only the <code>MarketplaceListingsSection</code> re-renders ‚Äî not the full page.
          The BFF route accepts optional <code>?catalogSku=</code> param to skip catalog re-fetch when called client-side.
        </div>
      </div>

    </div>

    <!-- Accessibility summary -->
    <div class="section-header mt-5"><span class="section-title">Accessibility Requirements</span></div>
    <div style="background:var(--bg-surface-2);border:1px solid var(--border-subtle);border-radius:var(--radius-md);padding:var(--sp-4);margin-top:var(--sp-3)">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:var(--sp-4);font-size:12px;line-height:1.8;color:var(--text-secondary)">
        <div>
          <div style="font-weight:600;color:var(--text-primary);margin-bottom:var(--sp-2)">Required ARIA attributes</div>
          <code style="display:block;background:var(--bg-base);padding:var(--sp-2);border-radius:var(--radius-sm);font-size:11px;line-height:1.9;color:var(--text-secondary)">
            &lt;button aria-label="Add to Cart from [Seller], [Condition], [Price]"&gt;<br>
            &lt;table aria-label="Active listings for [Card Name]"&gt;<br>
            &lt;tr aria-selected="true"&gt; (printings table)<br>
            &lt;section aria-live="polite"&gt; (listings section ‚Äî announces re-fetch)<br>
            &lt;div role="status"&gt; (degradation banner ‚Äî screen reader alert)
          </code>
        </div>
        <div>
          <div style="font-weight:600;color:var(--text-primary);margin-bottom:var(--sp-2)">Keyboard navigation</div>
          <div>Tab order: card image ‚Üí stats ‚Üí legality pills ‚Üí printings table rows ‚Üí sort controls ‚Üí listing rows ‚Üí Add to Cart buttons</div>
          <div style="margin-top:var(--sp-2)">Printings table: <kbd style="background:var(--bg-surface-3);padding:2px 6px;border-radius:4px;font-size:11px">‚Üë</kbd> / <kbd style="background:var(--bg-surface-3);padding:2px 6px;border-radius:4px;font-size:11px">‚Üì</kbd> to navigate rows, <kbd style="background:var(--bg-surface-3);padding:2px 6px;border-radius:4px;font-size:11px">Enter</kbd> to select print</div>
          <div style="margin-top:var(--sp-2)">Min touch targets: 44√ó44px ‚Äî especially condition chips (currently ~28px) ‚Üí wrap in a min-height:44px row div on mobile</div>
        </div>
      </div>
    </div>
  </div>

</div><!-- /panels -->

<!-- Toast notification mock -->
<div id="toast-container" style="position:fixed;bottom:24px;right:24px;z-index:9999;display:flex;flex-direction:column;gap:8px;pointer-events:none"></div>

<script>
function showPanel(name) {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('panel-' + name).classList.add('active');
  event.currentTarget.classList.add('active');
}

function showCartToast(btn, seller, cond, price) {
  showToast('üõí Cart coming soon ‚Äî ' + price + ' ¬∑ ' + seller + ' ¬∑ ' + cond);
}

function showToast(msg) {
  const container = document.getElementById('toast-container');
  const toast = document.createElement('div');
  toast.style.cssText = 'background:#22242E;border:1px solid rgba(255,255,255,0.1);border-radius:10px;padding:12px 16px;font-size:13px;color:#E8ECF1;max-width:320px;box-shadow:0 8px 32px rgba(0,0,0,0.5);pointer-events:auto;animation:toastIn 0.2s ease;line-height:1.5;';
  toast.textContent = msg;
  container.appendChild(toast);
  setTimeout(() => {
    toast.style.opacity = '0';
    toast.style.transition = 'opacity 0.3s';
    setTimeout(() => container.removeChild(toast), 300);
  }, 3000);
}
</script>

<style>
@keyframes toastIn { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }
</style>
</body>
</html>
