# Story 5.3: Collection Sync & Wishlist

## Status
Draft

## Story
**As a** user,
**I want** my deck to reflect owned cards,
**so that** I can plan purchases effectively.

## Acceptance Criteria
1. AC1: Users can mark cards as owned, traded, or wishlist with quantities.
2. AC2: Deck view indicates gaps and links to marketplace listings.
3. AC3: Bulk import from CSV or vendor inventory updates ownership status.
4. AC4: Collection data stored per account with version history.

## Tasks / Subtasks
- [ ] Extend deck builder UI to mark card ownership states and quantities (AC1).
- [ ] Highlight missing cards and surface marketplace CTAs for purchases (AC2).
- [ ] Implement bulk import endpoints for CSV/vendor inventory sync (AC3).
- [ ] Persist collection history with versioning and audit metadata (AC4).
- [ ] Sync collection data with customer backend profile for cross-feature use (AC1-AC4).
- [ ] Update user documentation on managing collection and wishlist (AC1-AC3).

## Dev Notes
- Ownership state stored in `customer-backend/packages/collection` tables; ensure relations to users + cards.
- Deck builder components under `storefront/src/components/deck-builder/collection` for UI changes.
- Bulk import should reuse CSV parsing approach from vendor inventory but scoped to user data.
- Version history can leverage soft delete or append-only table capturing diffs.
- Provide background job to reconcile vendor inventory sync for power users.

## Testing
- Unit tests for collection service functions (mark, bulk import, history).
- Integration tests verifying deck view renders ownership indicators and marketplace links.
- Playwright scenario: mark cards, import CSV, confirm deck updates and version history recorded.
- QA to validate error handling for malformed CSV or duplicate entries.

## Change Log
| Date       | Version | Description              | Author |
|------------|---------|--------------------------|--------|
| 2025-09-13 | 0.1.0   | Initial story draft      | Codex  |
