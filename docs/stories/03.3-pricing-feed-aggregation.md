# Story 3.3: Pricing Feed Aggregation

## Status
Draft

## Story
**As a** customer,
**I want** up-to-date pricing data,
**so that** I can make informed buying decisions.

## Acceptance Criteria
1. AC1: Pricing ETL aggregates vendor marketplace data and external price guides.
2. AC2: Rolling averages, trend deltas, and confidence scores computed per card/condition.
3. AC3: Price history stored for at least 365 days for analytics.
4. AC4: Data published as events for pricing intelligence consumers (Epic 07).

## Tasks / Subtasks
- [ ] Extend ETL pipeline to ingest vendor pricing feeds and external APIs, normalizing to canonical schema (AC1).
- [ ] Compute analytics metrics (averages, deltas, confidence) and persist alongside raw data (AC2).
- [ ] Implement historical storage strategy with partitions covering â‰¥365 days (AC3).
- [ ] Emit pricing update events to message bus for downstream consumers (AC4).
- [ ] Add monitoring for feed freshness and error handling per provider (AC1-AC4).
- [ ] Document pricing data quality checks and remediation playbook (AC1-AC4).

## Dev Notes
- ETL code under `customer-backend/packages/pricing/src/etl`; ensure provider adapters modular for new sources.
- Consider using timescale hypertables for historical data retention and query performance.
- Confidence scores may combine source reliability + variance metrics; align with analytics team.
- Event publishing via existing event bus (e.g., BullMQ or Kafka) with schema defined in `@sidedecked/events` if available.
- Ensure rate limits respected; use incremental updates where APIs allow.

## Testing
- Unit tests for aggregation math and normalization functions.
- Integration tests with recorded payloads verifying metrics stored correctly.
- Data quality tests: compare aggregated outputs against known benchmarks.
- Monitoring test: simulate stale feed to ensure alert triggers.

## Change Log
| Date       | Version | Description              | Author |
|------------|---------|--------------------------|--------|
| 2025-09-13 | 0.1.0   | Initial story draft      | Codex  |
