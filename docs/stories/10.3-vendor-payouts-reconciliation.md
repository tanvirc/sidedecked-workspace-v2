# Story 10.3: Vendor Payouts & Reconciliation

## Status
Draft

## Story
**As** finance,
**I want** accurate vendor payouts,
**so that** sellers are paid correctly and on time.

## Acceptance Criteria
1. AC1: Scheduled payouts triggered per vendor with configurable frequency.
2. AC2: Fees, taxes, and platform commissions calculated and stored per order line.
3. AC3: Exportable reconciliation reports (CSV, JSON) available for accounting systems.
4. AC4: Alerts for failed payouts or pending verification requirements issued promptly.

## Tasks / Subtasks
- [ ] Implement payout scheduler aggregating eligible balances per vendor and initiating Stripe transfers (AC1).
- [ ] Calculate/store fee, tax, commission breakdown per order line for reporting (AC2).
- [ ] Generate reconciliation exports with summaries + detail lines in CSV/JSON formats (AC3).
- [ ] Monitor payout outcomes, trigger alerts for failures or KYC holds, and surface in admin UI (AC4).
- [ ] Provide finance dashboard to review payouts, download reports, and override schedules (AC1-AC4).
- [ ] Update compliance documentation for payout process and retention requirements (AC2-AC4).

## Dev Notes
- Payout service under `backend/src/modules/payments/payouts`; ensure idempotent transfers via Stripe Connect.
- Store breakdown data in dedicated ledger tables for auditing.
- Exports accessible via secure admin endpoint; consider encryption/password protection if emailed.
- Alerts integrate with monitoring + Slack/email for finance team.
- Ensure timezone handling for payout scheduling to avoid mismatched cutoffs.

## Testing
- Unit tests for payout eligibility calculations and breakdown math.
- Integration tests simulating Stripe payout success/failure scenarios.
- Manual/automated test verifying reconciliation exports match ledger data.
- Monitoring test: force payout failure to confirm alert pipeline.

## Change Log
| Date       | Version | Description              | Author |
|------------|---------|--------------------------|--------|
| 2025-09-13 | 0.1.0   | Initial story draft      | Codex  |
