# Story 02.1: Shopping Cart Management

## Status
Draft

## Story
**As a** customer,
**I want** to manage a persistent shopping cart,
**so that** I can organize purchases across multiple vendors before checkout.

## Acceptance Criteria
1. AC1: "Add to cart" works from listings and detail pages with optimistic UI feedback.
2. AC2: Cart groups items by vendor and shows subtotals, shipping estimates, and taxes.
3. AC3: Quantity adjustments validate inventory and update totals immediately.
4. AC4: Items can be removed or saved for later; cart persists across sessions/devices.

## Tasks / Subtasks
- [ ] Audit existing cart components and refactor to support optimistic updates (AC1).
- [ ] Implement vendor grouping and subtotal calculations within cart state manager (AC2).
- [ ] Integrate inventory validation on quantity updates with backend API checks (AC3).
- [ ] Provide remove/save-for-later actions with persistence layer updates (AC4).
- [ ] Ensure cart persistence via backend session API and local cache fallback (AC4).
- [ ] Update UX (animations, notifications) per design guidance and add component tests (AC1-AC4).

## Dev Notes
- Storefront cart UI: `storefront/src/components/sections/Cart/` and related hooks in `storefront/src/hooks/cart/`.
- Backend cart APIs: confirm routes under `backend/src/api/store/carts/`; extend to support grouping metadata if needed.
- Saved-for-later may leverage wishlist service in customer backend (`customer-backend/src/services/wishlist/`).
- Ensure vendor metadata (name, rating, shipping) is accessible via API responses.
- Follow Medusa transaction patterns when adjusting backend cart services.

## Testing
- Component/unit tests for cart buttons, grouping, and persistence logic.
- Backend service tests verifying inventory check and grouping outputs.
- Playwright end-to-end scenario: add items from two vendors, adjust quantities, reload session.
- Validate accessibility (keyboard actions, ARIA) for cart controls.

## Change Log
| Date       | Version | Description              | Author |
|------------|---------|--------------------------|--------|
| 2025-09-12 | 0.1.0   | Initial story draft      | Codex  |
