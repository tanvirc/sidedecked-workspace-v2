# Story 5.2: Validation & Rules Engine

## Status
Draft

## Story
**As a** player,
**I want** legality checks on my decks,
**so that** my builds meet tournament requirements.

## Acceptance Criteria
1. AC1: Validation rules loaded per game/format and evaluated on every deck change.
2. AC2: Violations surfaced inline with actionable guidance.
3. AC3: Exports (PDF/Text) include validation summary and key metrics.
4. AC4: API endpoints available for external deck import via code strings.

## Tasks / Subtasks
- [ ] Implement rules engine service consuming per-game rulesets and evaluating deck state (AC1).
- [ ] Surface validation results inline in deck builder UI with severity indicators and guidance (AC2).
- [ ] Extend export functionality to include validation summary + metrics (AC3).
- [ ] Build API endpoint to import decks via code strings and return validation results (AC4).
- [ ] Add caching/invalidations for ruleset updates and version tracking (AC1-AC2).
- [ ] Document validation coverage per game and update support FAQs (AC1-AC4).

## Dev Notes
- Rules engine service under `customer-backend/packages/deck-builder/src/validation`.
- Rulesets stored in database or config repo; include version + effective date.
- Deck builder UI updates in `storefront/src/components/deck-builder/validation-panel.tsx`.
- Exports handled by existing PDF/text generator; include new sections for validation.
- API endpoint accessible via `customer-backend/src/routes/decks/import` returning validation payload.

## Testing
- Unit tests for rules evaluation per game/format with sample fixtures.
- Integration tests covering deck change triggers and export output.
- Playwright scenario: build invalid deck, view guidance, correct issues, export summary.
- Regression tests for deck code import (TCG-specific formats like MTG Arena codes).

## Change Log
| Date       | Version | Description              | Author |
|------------|---------|--------------------------|--------|
| 2025-09-13 | 0.1.0   | Initial story draft      | Codex  |
