# Story 3.2: Media & Asset Processing

## Status
Draft

## Story
**As a** storefront user,
**I want** crisp images and set symbols,
**so that** browsing the catalog feels premium.

## Acceptance Criteria
1. AC1: Image pipeline downloads, optimizes, and stores card images in MinIO with responsive sizes.
2. AC2: Placeholder blurhash metadata generated for progressive loading.
3. AC3: Set icons and symbols normalized and exposed via CDN endpoints.
4. AC4: Broken image detection in place with fallback assets and monitoring.

## Tasks / Subtasks
- [ ] Implement media worker fetching card art, resizing variants, and uploading to storage bucket (AC1).
- [ ] Generate blurhash metadata per asset and persist alongside image records (AC2).
- [ ] Normalize set icons/symbols and publish accessible URLs via CDN config (AC3).
- [ ] Add monitoring job to detect missing/broken images and trigger fallback replacements (AC4).
- [ ] Update storefront image components to consume new responsive assets and blurhash (AC1-AC2).
- [ ] Document asset pipeline operations and troubleshooting in catalog runbook (AC1-AC4).

## Dev Notes
- Worker implementation under `customer-backend/packages/tcg-catalog/src/etl/media-worker.ts`.
- Use sharp/imagemagick for resizing; store metadata (checksum, version) for cache busting.
- CDN configuration may require updates in infrastructure repo (document packaged steps).
- Broken image detection can run as scheduled job comparing catalog records vs storage.
- Ensure licensing/attribution requirements for card art handled properly.

## Testing
- Unit tests for media transform functions and storage utilities.
- Integration test running pipeline on sample set verifying outputs exist in bucket.
- Visual regression in storefront ensuring blurhash + responsive images function.
- Monitoring test: simulate missing asset and confirm alert/fallback triggered.

## Change Log
| Date       | Version | Description              | Author |
|------------|---------|--------------------------|--------|
| 2025-09-13 | 0.1.0   | Initial story draft      | Codex  |
