# Story 6.2: Discussion Threads & Comments

## Status
Draft

## Story
**As a** community member,
**I want** to comment and react on content,
**so that** I can collaborate with other players.

## Acceptance Criteria
1. AC1: Nested comment threads support reactions (like, insightful, report) per item.
2. AC2: Markdown/rich-text editor with sanitization and preview available.
3. AC3: Moderation queue handles reports with workflow for moderators.
4. AC4: Notifications triggered for mentions and replies.

## Tasks / Subtasks
- [ ] Implement nested comment data model + APIs supporting reactions and pagination (AC1).
- [ ] Build rich-text editor with markdown preview and sanitization pipeline (AC2).
- [ ] Create moderation queue UI + backend workflow for handling reports/escalations (AC3).
- [ ] Integrate notification service for mentions/replies (email + in-app) (AC4).
- [ ] Add rate limiting/anti-spam protections for comment posting (AC1, AC3).
- [ ] Update community guidelines and documentation for comment usage (AC3-AC4).

## Dev Notes
- Comment service under `customer-backend/packages/community/comments`; use tree structure or adjacency list.
- Sanitization via `DOMPurify` or server-side equivalent; store raw + sanitized content separately.
- Moderation queue should integrate with admin portal; track statuses/resolution notes.
- Notification integration with TalkJS or internal notifier; include deep links.
- Provide GraphQL/REST endpoints for fetching comment threads with pagination.

## Testing
- Unit tests for comment CRUD, reactions, and sanitization.
- Integration tests for moderation workflow and notification triggers.
- Playwright scenario: post comment, reply, mention user, verify notifications.
- Security tests to ensure sanitization prevents XSS/markdown injection.

## Change Log
| Date       | Version | Description              | Author |
|------------|---------|--------------------------|--------|
| 2025-09-13 | 0.1.0   | Initial story draft      | Codex  |
