# Story 7.2: Price Alerting Engine

## Status
Draft

## Story
**As a** collector,
**I want** alerts when prices move,
**so that** I can buy or sell at the right time.

## Acceptance Criteria
1. AC1: Users define alert rules (price drops %, absolute value, availability changes).
2. AC2: Engine evaluates rules on new pricing events and queues notifications.
3. AC3: Deduplicate alerts per user within configurable quiet periods.
4. AC4: Notification payload links to relevant product pages and includes summary.

## Tasks / Subtasks
- [ ] Build alert rule management API/UI for creating thresholds and channels (AC1).
- [ ] Implement evaluation worker consuming pricing events (from Story 3.3) and triggering alerts (AC2).
- [ ] Add deduplication/quiet-period enforcement with user-configurable windows (AC3).
- [ ] Format notification payloads (email, push) with deep links and summaries (AC4).
- [ ] Provide alert history view for users with status tracking (AC2-AC4).
- [ ] Update docs/support materials describing alert capabilities and limits (AC1-AC3).

## Dev Notes
- Alert definitions stored in `customer-backend/packages/pricing/alerts` tables; ensure indexes for evaluation.
- Worker can run on BullMQ queue triggered by pricing aggregation event bus.
- Dedup logic might leverage Redis keyed by user+card; store last sent timestamp.
- Notification integration with TalkJS or email provider; include CTA to manage alerts.
- Allow users to pause/disable alerts quickly from UI.

## Testing
- Unit tests for rule evaluation, deduplication, and payload formatting.
- Integration tests feeding synthetic pricing events verifying notifications + quiet periods.
- Playwright scenario: user creates alert, triggers price change, receives notification.
- Load test for large number of alerts to ensure throughput.

## Change Log
| Date       | Version | Description              | Author |
|------------|---------|--------------------------|--------|
| 2025-09-13 | 0.1.0   | Initial story draft      | Codex  |
