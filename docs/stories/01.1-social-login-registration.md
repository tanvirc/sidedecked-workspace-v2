# Story 01.1: Social Login Registration

## Status
Draft

## Story
**As a** new user,
**I want** to register with my preferred OAuth provider,
**so that** I can access SideDecked without completing a long form.

## Acceptance Criteria
1. AC1: OAuth buttons expose Google, GitHub, Microsoft, Facebook, and Apple with PKCE + state validation.
2. AC2: Successful callback creates a new account with provider metadata persisted (id, email, tokens).
3. AC3: Error states display provider-specific messaging with retry logging/analytics.
4. AC4: Registration automatically generates a Stripe customer profile stub for future checkout readiness.

## Tasks / Subtasks
- [ ] Update storefront registration modal to show provider buttons with loading/disabled states (AC1).
- [ ] Implement OAuth initiation endpoint(s) ensuring PKCE + anti-forgery state handling (AC1).
- [ ] Handle callback flow, creating user records and storing provider metadata (AC2).
- [ ] Integrate analytics/error tracking and present actionable error feedback (AC3).
- [ ] Invoke backend Stripe customer provisioning during account creation (AC4).
- [ ] Add regression/unit tests in backend and storefront covering success/error paths (AC1-AC4).

## Dev Notes
- Storefront components: `storefront/src/app/(auth)/user/register` and shared `SocialLoginButtons` module for provider list/order.
- Backend MercurJS auth module: ensure PKCE, state validation, and idempotency in callback handler.
- Persist provider tokens via secure storage; align with security guidance in `docs/architecture/07-authentication-architecture.md`.
- Stripe customer creation should occur via existing commerce service or new adapter (check `backend/src/services/stripe/`).
- Record analytics events via existing telemetry utilities (look for logging wrappers in `backend/src/utils/logger.ts`).

## Testing
- Add backend unit/integration tests for OAuth service (`backend/src/services/auth/__tests__`).
- Storefront component tests using React Testing Library for button states and error messaging.
- Playwright/MSW integration test for registration happy path and error scenario.
- Run `npm run test:coverage` in affected repos and verify â‰¥80% coverage in touched modules.

## Change Log
| Date       | Version | Description              | Author |
|------------|---------|--------------------------|--------|
| 2025-09-12 | 0.1.0   | Initial story draft      | Codex  |
