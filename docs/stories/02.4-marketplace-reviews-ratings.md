# Story 2.4: Marketplace Reviews & Seller Ratings

## Status
Draft

## Story
**As a** buyer,
**I want** to review purchases and rate sellers,
**so that** the marketplace remains trustworthy.

## Acceptance Criteria
1. AC1: Post-delivery prompts allow rating seller and product condition.
2. AC2: Reviews require completed purchase and enforce idempotent submission per order line.
3. AC3: Aggregate ratings appear on seller profiles and product detail pages.
4. AC4: Moderation queues available for flagged reviews and integrate with community policies.

## Tasks / Subtasks
- [ ] Implement review prompt flow (email + in-app) after delivery confirmation (AC1).
- [ ] Build review submission API enforcing purchase verification and idempotency (AC2).
- [ ] Surface ratings averages on seller profile and product detail components (AC3).
- [ ] Create moderation queue UI + backend workflow for flagged reviews (AC4).
- [ ] Integrate review data with analytics dashboards for vendor insights (AC3-AC4).
- [ ] Update terms/community guidelines to include review policies (AC4).

## Dev Notes
- Review UI components: `storefront/src/components/reviews/`; add modal or page for submission.
- Backend review service should live in `backend/src/modules/reviews` using Medusa patterns.
- Idempotency: store review keyed by order_line_id + user_id; update existing review rather than duplicate.
- Moderation integrates with community tooling (Epic 06) via shared queue or events.
- Ensure rating changes recalculate vendor metrics consumed by vendor panel analytics.

## Testing
- Unit tests for review eligibility service and rating aggregation.
- Integration tests verifying moderation workflow and flagged review notifications.
- Playwright scenario: receive prompt, submit review, view rating updates on product page.
- Security test: attempt review without purchase to confirm rejection.

## Change Log
| Date       | Version | Description              | Author |
|------------|---------|--------------------------|--------|
| 2025-09-13 | 0.1.0   | Initial story draft      | Codex  |
